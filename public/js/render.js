'use strict';

;
//
//	Utils
//
// * animate(cb, duraton) -- wrapper of requestAnimationFrame
//
// DOM manipulations
//
// * closePopup(event) -- close popup with users unique code
// * onVolumeBtnClick(event) -- handler for volume buttons clicks (mute/unmute trigger)
// * onVolumeSliderInput(event) -- change audio volume whenvolume slider is being moved
// * updateScore(number) -- update current score
//
//	Canvas
//
// * refreshComputedSizes(object) -- change <canvas> sizes to actual
// * addMovementOnCanvas(movementInfo) -- add new movement canvas-object
// * animateMovement(object) -- make recieved already added movement run (animate)
// * onAgSetupEvent(event) -- handler for event, fired when game settings are recieved
//
// To remove
//
// * start() -- start game
// * nextBeat(isFirst) -- process (and add) next movement
//
// Initialization
//

(function () {

	function animate(draw, duration) {
		var start = performance.now();

		requestAnimationFrame(function animate(time) {
			// определить, сколько прошло времени с начала анимации
			var timePassed = time - start;

			// возможно небольшое превышение времени, в этом случае зафиксировать конец
			if (timePassed > duration) timePassed = duration;

			// нарисовать состояние анимации в момент timePassed
			draw(timePassed);

			// если время анимации не закончилось - запланировать ещё кадр
			if (timePassed < duration) {
				requestAnimationFrame(animate);
			}
		});
	}

	var config = {
		colors: {
			neutral: '#FFA700', // #8D99AE #107E7D
			success: '#C2E812',
			fail: '#B80C09'
		},
		movements: {
			radiusPercent: 4,
			strokeWidthPercent: 0.5
		}
	};

	function closePopup(event) {
		document.querySelectorAll('.popup')[0].classList.add('closed');
		document.querySelectorAll('.logo')[0].classList.remove('with-popup');
	}

	// Mutes / unmutes audio
	function onVolumeBtnClick(event) {

		if (!config.currentAudio.muted) {

			// Change view
			this.childNodes[1].classList.remove('fa-volume-up');
			this.childNodes[1].classList.add('fa-volume-off');

			// Mute
			config.currentAudio.mute();
			config.currentAudio.muted = true;
		} else {

			// Change view
			this.childNodes[1].classList.remove('fa-volume-off');
			this.childNodes[1].classList.add('fa-volume-up');

			// Unmute
			config.currentAudio.unmute();
			config.currentAudio.muted = false;
		}
		console.log(this);
	}

	// Change volume level of current audio
	function onVolumeSliderInput(event) {
		config.currentAudio.volume(this.value / 100);
	}

	function updateScore(add) {

		var score = document.querySelectorAll('.score')[0];
		var scoreNumber = document.querySelectorAll('.score-number')[0];

		score.classList.add('update');
		setTimeout(function () {
			score.classList.remove('update');
		}, 400);

		config.currentScore += parseInt(add);
		scoreNumber.innerHTML = config.currentScore;

		return config.currentScore;
	}

	// **********
	// * CANVAS *
	// **********

	// Changes canvas background size when fired
	function refreshComputedSizes(object) {

		config.canvOpts.computedStyle = {
			width: +object.width.slice(0, -2),
			height: +object.height.slice(0, -2)
		};

		canvas.setDimensions({
			width: config.canvOpts.computedStyle.width,
			height: config.canvOpts.computedStyle.height
		});
	}

	function addMovementOnCanvas(movementInfo) {

		var radius = config.canvOpts.movements.radius;
		var strokeWidth = config.canvOpts.movements.strokeWidth;
		// var x = Math.round(config.canvOpts.computedStyle.width - (config.canvOpts.computedStyle.width/100)*3) - radius*2;
		var x = Math.round(config.canvOpts.computedStyle.width);
		var y = Math.round(config.oneHPercent * 45);

		// console.log(x + ' - ' + y);

		var movement = new fabric.Circle({
			fill: movementInfo.color,
			stroke: '#FFFFFF',
			strokeWidth: strokeWidth,
			radius: radius,
			// radius: 100,
			top: y,
			left: x
			// left: 262
		});

		movementInfo.canvasObject = movement;

		console.log(movement);
		canvas.add(movement);
		canvas.renderAll();
		// movementInfo.state = 'added';
	}

	function animateMovement(movementInfo) {
		// movementInfo.canvasObject.animate('left', ''+(config.oneWPercent * 20), {
		// 	// onChange: canvas.renderAll.bind(canvas),
		// 	onChange: requestAnimationFrame(canvas.renderAll.bind(canvas), 100),
		// 	// duration: config.currentMinInterval*16
		// });

		animate(function (time) {
			movementInfo.canvasObject.setLeft(time / config.currentMinInterval * 16 + config.oneWPercent * 20);
			canvas.renderAll.bind(canvas);
		}, config.currentMinInterval * 16);
	}

	// Actions performed when current game settings recieved
	function onAgSetupEvent(event) {

		var audioFileURL = 'http://' + window.location.hostname + '/songs/' + event.detail.song;
		// let audioFileURL = '../audio/' + event.detail.song;

		// console.log(audioFileURL);

		config.currentAudio = new Howl({
			urls: [audioFileURL],
			autoplay: false,
			volume: 0.8
		});

		config.currentMovements = event.detail.commands.map(function (currentValue, index, array) {
			return {
				index: index,
				name: currentValue,
				color: config.colors.neutral
			};
		});

		// BPM, minInterval, beginning offset
		// config.currentBpm = event.detail.bpm;
		config.currentBpm = 128;
		config.currentMinInterval = config.currentBpm * 1000 / (60 * 16);
		config.currentBeginningOffset = event.detail.offset;

		// Test
		// addMovementOnCanvas(config.currentMovements[1]);
		start();
	}

	function start() {
		config.currentScore = 0;
		config.currentStartDate = Date.now();
		setTimeout(function () {
			nextBeat(true);
		}, config.currentBeginningOffset);
		config.currentAudio.play();
	}

	function nextBeat(isFirst) {

		// If we're in the beginning of song
		if (isFirst === true) {
			addMovementOnCanvas(config.currentMovements[0]);
			animateMovement(config.currentMovements[0]);
			// setTimeout(nextBeat, config.currentMinInterval);
			return;
		}

		// Insert new movement
		var appearingMovementIndex = Math.floor((Date.now() - config.currentStartDate) / config.currentMinInterval);

		console.log(appearingMovementIndex);

		var appearingMovement = config.currentMovements[appearingMovementIndex];

		addMovementOnCanvas(appearingMovement);
		animateMovement(appearingMovement);
		// setTimeout(nextBeat, config.currentMinInterval);
		console.log(appearingMovementIndex);
	}

	// ********
	// * Init *
	// ********

	config.currentMovements = [];
	config.currentScore = 0;
	config.currentStartDate = 0;

	// Get computed styles of whole page wrapper
	var canvasComputedStyleObj = getComputedStyle(document.querySelectorAll('.wr')[0]);

	// Set canvas options
	config.oneWPercent = parseInt(canvasComputedStyleObj.width.slice(0, -2)) / 100;
	config.oneHPercent = parseInt(canvasComputedStyleObj.height.slice(0, -2)) / 100;

	config.canvOpts = {
		bgURL: '../img/bg-crowd-1.jpg',
		computedStyle: {
			width: config.oneWPercent * 100,
			height: config.oneHPercent * 100
		},
		movements: {
			radius: config.oneWPercent * config.movements.radiusPercent,
			strokeWidth: config.oneWPercent * config.movements.strokeWidthPercent
		}
	};

	// Initialize 'fabric' canvas obj
	var canvas = new fabric.StaticCanvas('game', {
		width: config.canvOpts.computedStyle.width,
		height: config.canvOpts.computedStyle.height
	});

	// Draw "perfect success" place shadow circle
	var shadowCircle = new fabric.Circle({
		// fill: config.colors.neutral,
		fill: 'rgba(200,200,200,0.2)',
		stroke: 'rgba(200,200,200,1)',
		strokeWidth: config.canvOpts.movements.strokeWidth,
		radius: config.canvOpts.movements.radius,
		top: Math.round(config.oneHPercent * 45),
		left: config.oneWPercent * 20
	});
	canvas.add(shadowCircle);

	// Set handler for game setup event
	document.addEventListener('agSetupEvent', onAgSetupEvent);

	// Show current game code
	var codeContainer = document.getElementById('code-container');
	codeContainer.innerHTML = code;

	// *********
	// * Audio *
	// *********

	// Add muted state saving feature to Howl (audio lib)
	Howl.prototype.muted = false;
	Howl.muted = false;

	// Get volume button element
	var volumeBtn = document.querySelectorAll('.volume-btn')[0];
	// and set onClick event handler
	volumeBtn.addEventListener('click', onVolumeBtnClick);

	// Get volume level slider
	var volumeSlider = document.querySelectorAll('.volume-input')[0];
	// and set onInput event handler
	volumeSlider.addEventListener('input', onVolumeSliderInput);

	// Change canvas background size on window resize
	window.onresize = function () {
		refreshComputedSizes(canvasComputedStyleObj);
		canvas.renderAll.bind(canvas);
	};

	// TEST
	document.addEventListener('click', closePopup);
})();
//# sourceMappingURL=data:application/json;base64,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QUFDQSxTQUFPLFNBQVAsQ0FBaUIsSUFBakIsQ0FBc0IsTUFBdEI7QUFDQSxFQUhEOzs7QUFjQSxVQUFTLGdCQUFULENBQTBCLE9BQTFCLEVBQW1DLFVBQW5DO0FBRUMsQ0E1VEQiLCJmaWxlIjoicmVuZGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiO1xuLy9cbi8vXHRVdGlsc1xuLy9cbi8vICogYW5pbWF0ZShjYiwgZHVyYXRvbikgLS0gd3JhcHBlciBvZiByZXF1ZXN0QW5pbWF0aW9uRnJhbWVcbi8vXG4vLyBET00gbWFuaXB1bGF0aW9uc1xuLy9cbi8vICogY2xvc2VQb3B1cChldmVudCkgLS0gY2xvc2UgcG9wdXAgd2l0aCB1c2VycyB1bmlxdWUgY29kZVxuLy8gKiBvblZvbHVtZUJ0bkNsaWNrKGV2ZW50KSAtLSBoYW5kbGVyIGZvciB2b2x1bWUgYnV0dG9ucyBjbGlja3MgKG11dGUvdW5tdXRlIHRyaWdnZXIpXG4vLyAqIG9uVm9sdW1lU2xpZGVySW5wdXQoZXZlbnQpIC0tIGNoYW5nZSBhdWRpbyB2b2x1bWUgd2hlbnZvbHVtZSBzbGlkZXIgaXMgYmVpbmcgbW92ZWRcbi8vICogdXBkYXRlU2NvcmUobnVtYmVyKSAtLSB1cGRhdGUgY3VycmVudCBzY29yZVxuLy9cbi8vXHRDYW52YXNcbi8vXG4vLyAqIHJlZnJlc2hDb21wdXRlZFNpemVzKG9iamVjdCkgLS0gY2hhbmdlIDxjYW52YXM+IHNpemVzIHRvIGFjdHVhbFxuLy8gKiBhZGRNb3ZlbWVudE9uQ2FudmFzKG1vdmVtZW50SW5mbykgLS0gYWRkIG5ldyBtb3ZlbWVudCBjYW52YXMtb2JqZWN0XG4vLyAqIGFuaW1hdGVNb3ZlbWVudChvYmplY3QpIC0tIG1ha2UgcmVjaWV2ZWQgYWxyZWFkeSBhZGRlZCBtb3ZlbWVudCBydW4gKGFuaW1hdGUpXG4vLyAqIG9uQWdTZXR1cEV2ZW50KGV2ZW50KSAtLSBoYW5kbGVyIGZvciBldmVudCwgZmlyZWQgd2hlbiBnYW1lIHNldHRpbmdzIGFyZSByZWNpZXZlZFxuLy9cbi8vIFRvIHJlbW92ZVxuLy9cbi8vICogc3RhcnQoKSAtLSBzdGFydCBnYW1lXG4vLyAqIG5leHRCZWF0KGlzRmlyc3QpIC0tIHByb2Nlc3MgKGFuZCBhZGQpIG5leHQgbW92ZW1lbnRcbi8vXG4vLyBJbml0aWFsaXphdGlvblxuLy9cblxuXG4oZnVuY3Rpb24oKXtcblxuZnVuY3Rpb24gYW5pbWF0ZShkcmF3LCBkdXJhdGlvbikge1xuICB2YXIgc3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTtcblxuICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gYW5pbWF0ZSh0aW1lKSB7XG4gICAgLy8g0L7Qv9GA0LXQtNC10LvQuNGC0YwsINGB0LrQvtC70YzQutC+INC/0YDQvtGI0LvQviDQstGA0LXQvNC10L3QuCDRgSDQvdCw0YfQsNC70LAg0LDQvdC40LzQsNGG0LjQuFxuICAgIHZhciB0aW1lUGFzc2VkID0gdGltZSAtIHN0YXJ0O1xuXG4gICAgLy8g0LLQvtC30LzQvtC20L3QviDQvdC10LHQvtC70YzRiNC+0LUg0L/RgNC10LLRi9GI0LXQvdC40LUg0LLRgNC10LzQtdC90LgsINCyINGN0YLQvtC8INGB0LvRg9GH0LDQtSDQt9Cw0YTQuNC60YHQuNGA0L7QstCw0YLRjCDQutC+0L3QtdGGXG4gICAgaWYgKHRpbWVQYXNzZWQgPiBkdXJhdGlvbikgdGltZVBhc3NlZCA9IGR1cmF0aW9uO1xuXG4gICAgLy8g0L3QsNGA0LjRgdC+0LLQsNGC0Ywg0YHQvtGB0YLQvtGP0L3QuNC1INCw0L3QuNC80LDRhtC40Lgg0LIg0LzQvtC80LXQvdGCIHRpbWVQYXNzZWRcbiAgICBkcmF3KHRpbWVQYXNzZWQpO1xuXG4gICAgLy8g0LXRgdC70Lgg0LLRgNC10LzRjyDQsNC90LjQvNCw0YbQuNC4INC90LUg0LfQsNC60L7QvdGH0LjQu9C+0YHRjCAtINC30LDQv9C70LDQvdC40YDQvtCy0LDRgtGMINC10YnRkSDQutCw0LTRgFxuICAgIGlmICh0aW1lUGFzc2VkIDwgZHVyYXRpb24pIHtcbiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTtcbiAgICB9XG5cbiAgfSk7XG59XG5cblxudmFyIGNvbmZpZyA9IHtcblx0Y29sb3JzOiB7XG5cdFx0bmV1dHJhbDogJyNGRkE3MDAnLCAvLyAjOEQ5OUFFICMxMDdFN0Rcblx0XHRzdWNjZXNzOiAnI0MyRTgxMicsXG5cdFx0ZmFpbDogJyNCODBDMDknXG5cdH0sXG5cdG1vdmVtZW50czoge1xuXHRcdHJhZGl1c1BlcmNlbnQ6IDQsXG5cdFx0c3Ryb2tlV2lkdGhQZXJjZW50OiAwLjVcblx0fVxufVxuXG5mdW5jdGlvbiBjbG9zZVBvcHVwKGV2ZW50KSB7XG5cdGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wb3B1cCcpWzBdLmNsYXNzTGlzdC5hZGQoJ2Nsb3NlZCcpXG5cdGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5sb2dvJylbMF0uY2xhc3NMaXN0LnJlbW92ZSgnd2l0aC1wb3B1cCcpXG59XG5cbi8vIE11dGVzIC8gdW5tdXRlcyBhdWRpb1xuZnVuY3Rpb24gb25Wb2x1bWVCdG5DbGljayhldmVudCkge1xuXG5cdGlmICghY29uZmlnLmN1cnJlbnRBdWRpby5tdXRlZCkge1xuXG5cdFx0Ly8gQ2hhbmdlIHZpZXdcblx0XHR0aGlzLmNoaWxkTm9kZXNbMV0uY2xhc3NMaXN0LnJlbW92ZSgnZmEtdm9sdW1lLXVwJyk7XG5cdFx0dGhpcy5jaGlsZE5vZGVzWzFdLmNsYXNzTGlzdC5hZGQoJ2ZhLXZvbHVtZS1vZmYnKTtcblxuXHRcdC8vIE11dGVcblx0XHRjb25maWcuY3VycmVudEF1ZGlvLm11dGUoKTtcblx0XHRjb25maWcuY3VycmVudEF1ZGlvLm11dGVkID0gdHJ1ZTtcblx0fSBlbHNlIHtcblxuXHRcdC8vIENoYW5nZSB2aWV3XG5cdFx0dGhpcy5jaGlsZE5vZGVzWzFdLmNsYXNzTGlzdC5yZW1vdmUoJ2ZhLXZvbHVtZS1vZmYnKTtcblx0XHR0aGlzLmNoaWxkTm9kZXNbMV0uY2xhc3NMaXN0LmFkZCgnZmEtdm9sdW1lLXVwJyk7XG5cblx0XHQvLyBVbm11dGVcblx0XHRjb25maWcuY3VycmVudEF1ZGlvLnVubXV0ZSgpO1xuXHRcdGNvbmZpZy5jdXJyZW50QXVkaW8ubXV0ZWQgPSBmYWxzZTtcblx0fVxuXHRjb25zb2xlLmxvZyh0aGlzKTtcblxufVxuXG4vLyBDaGFuZ2Ugdm9sdW1lIGxldmVsIG9mIGN1cnJlbnQgYXVkaW9cbmZ1bmN0aW9uIG9uVm9sdW1lU2xpZGVySW5wdXQoZXZlbnQpIHtcblx0Y29uZmlnLmN1cnJlbnRBdWRpby52b2x1bWUodGhpcy52YWx1ZS8xMDApO1xufVxuXG5mdW5jdGlvbiB1cGRhdGVTY29yZShhZGQpIHtcblxuXHR2YXIgc2NvcmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2NvcmUnKVswXTtcblx0dmFyIHNjb3JlTnVtYmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNjb3JlLW51bWJlcicpWzBdO1xuXG5cdHNjb3JlLmNsYXNzTGlzdC5hZGQoJ3VwZGF0ZScpO1xuXHRzZXRUaW1lb3V0KCgpPT57IHNjb3JlLmNsYXNzTGlzdC5yZW1vdmUoJ3VwZGF0ZScpOyB9LCA0MDApO1xuXG5cdGNvbmZpZy5jdXJyZW50U2NvcmUgKz0gcGFyc2VJbnQoYWRkKTtcblx0c2NvcmVOdW1iZXIuaW5uZXJIVE1MID0gY29uZmlnLmN1cnJlbnRTY29yZTtcblxuXHRyZXR1cm4gY29uZmlnLmN1cnJlbnRTY29yZTtcblxufVxuXG4vLyAqKioqKioqKioqXG4vLyAqIENBTlZBUyAqXG4vLyAqKioqKioqKioqXG5cbi8vIENoYW5nZXMgY2FudmFzIGJhY2tncm91bmQgc2l6ZSB3aGVuIGZpcmVkXG5mdW5jdGlvbiByZWZyZXNoQ29tcHV0ZWRTaXplcyhvYmplY3QpIHtcblx0XG5cdGNvbmZpZy5jYW52T3B0cy5jb21wdXRlZFN0eWxlID0ge1xuXHRcdHdpZHRoOiArb2JqZWN0LndpZHRoLnNsaWNlKDAsLTIpLFxuXHRcdGhlaWdodDogK29iamVjdC5oZWlnaHQuc2xpY2UoMCwtMilcblx0fTtcblxuXHRjYW52YXMuc2V0RGltZW5zaW9ucyh7XG5cdFx0d2lkdGg6IGNvbmZpZy5jYW52T3B0cy5jb21wdXRlZFN0eWxlLndpZHRoLFxuXHRcdGhlaWdodDogY29uZmlnLmNhbnZPcHRzLmNvbXB1dGVkU3R5bGUuaGVpZ2h0XG5cdH0pO1xuXG59XG5cblxuZnVuY3Rpb24gYWRkTW92ZW1lbnRPbkNhbnZhcyhtb3ZlbWVudEluZm8pIHtcblxuXHR2YXIgcmFkaXVzID0gY29uZmlnLmNhbnZPcHRzLm1vdmVtZW50cy5yYWRpdXM7XG5cdHZhciBzdHJva2VXaWR0aCA9IGNvbmZpZy5jYW52T3B0cy5tb3ZlbWVudHMuc3Ryb2tlV2lkdGg7XG5cdC8vIHZhciB4ID0gTWF0aC5yb3VuZChjb25maWcuY2Fudk9wdHMuY29tcHV0ZWRTdHlsZS53aWR0aCAtIChjb25maWcuY2Fudk9wdHMuY29tcHV0ZWRTdHlsZS53aWR0aC8xMDApKjMpIC0gcmFkaXVzKjI7XG5cdHZhciB4ID0gTWF0aC5yb3VuZChjb25maWcuY2Fudk9wdHMuY29tcHV0ZWRTdHlsZS53aWR0aCk7XG5cdHZhciB5ID0gTWF0aC5yb3VuZChjb25maWcub25lSFBlcmNlbnQgKiA0NSk7XG5cblx0Ly8gY29uc29sZS5sb2coeCArICcgLSAnICsgeSk7XG5cblx0dmFyIG1vdmVtZW50ID0gbmV3IGZhYnJpYy5DaXJjbGUoe1xuXHRcdGZpbGw6IG1vdmVtZW50SW5mby5jb2xvcixcblx0XHRzdHJva2U6ICcjRkZGRkZGJyxcblx0XHRzdHJva2VXaWR0aDogc3Ryb2tlV2lkdGgsXG5cdFx0cmFkaXVzOiByYWRpdXMsXG5cdFx0Ly8gcmFkaXVzOiAxMDAsXG5cdFx0dG9wOiB5LFxuXHRcdGxlZnQ6IHhcblx0XHQvLyBsZWZ0OiAyNjJcblx0fSk7XG5cblx0bW92ZW1lbnRJbmZvLmNhbnZhc09iamVjdCA9IG1vdmVtZW50XG5cblx0Y29uc29sZS5sb2cobW92ZW1lbnQpO1xuXHRjYW52YXMuYWRkKG1vdmVtZW50KTtcblx0Y2FudmFzLnJlbmRlckFsbCgpO1xuXHQvLyBtb3ZlbWVudEluZm8uc3RhdGUgPSAnYWRkZWQnO1xufVxuXG5mdW5jdGlvbiBhbmltYXRlTW92ZW1lbnQobW92ZW1lbnRJbmZvKSB7XG5cdC8vIG1vdmVtZW50SW5mby5jYW52YXNPYmplY3QuYW5pbWF0ZSgnbGVmdCcsICcnKyhjb25maWcub25lV1BlcmNlbnQgKiAyMCksIHtcblx0Ly8gXHQvLyBvbkNoYW5nZTogY2FudmFzLnJlbmRlckFsbC5iaW5kKGNhbnZhcyksXG5cdC8vIFx0b25DaGFuZ2U6IHJlcXVlc3RBbmltYXRpb25GcmFtZShjYW52YXMucmVuZGVyQWxsLmJpbmQoY2FudmFzKSwgMTAwKSxcblx0Ly8gXHQvLyBkdXJhdGlvbjogY29uZmlnLmN1cnJlbnRNaW5JbnRlcnZhbCoxNlxuXHQvLyB9KTtcblxuXHRhbmltYXRlKGZ1bmN0aW9uKHRpbWUpe1xuXHRcdG1vdmVtZW50SW5mby5jYW52YXNPYmplY3Quc2V0TGVmdCggKHRpbWUvY29uZmlnLmN1cnJlbnRNaW5JbnRlcnZhbCoxNikgKyBjb25maWcub25lV1BlcmNlbnQqMjAgKTtcblx0XHRjYW52YXMucmVuZGVyQWxsLmJpbmQoY2FudmFzKTtcblx0fSwgY29uZmlnLmN1cnJlbnRNaW5JbnRlcnZhbCoxNik7XG59XG5cblxuLy8gQWN0aW9ucyBwZXJmb3JtZWQgd2hlbiBjdXJyZW50IGdhbWUgc2V0dGluZ3MgcmVjaWV2ZWRcbmZ1bmN0aW9uIG9uQWdTZXR1cEV2ZW50KGV2ZW50KSB7XG5cblx0bGV0IGF1ZGlvRmlsZVVSTCA9ICdodHRwOi8vJyArIHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSArICcvc29uZ3MvJyArIGV2ZW50LmRldGFpbC5zb25nO1xuXHQvLyBsZXQgYXVkaW9GaWxlVVJMID0gJy4uL2F1ZGlvLycgKyBldmVudC5kZXRhaWwuc29uZztcblxuXHQvLyBjb25zb2xlLmxvZyhhdWRpb0ZpbGVVUkwpO1xuXG5cdGNvbmZpZy5jdXJyZW50QXVkaW8gPSBuZXcgSG93bCh7XG5cdFx0dXJsczogW2F1ZGlvRmlsZVVSTF0sXG5cdFx0YXV0b3BsYXk6IGZhbHNlLFxuXHRcdHZvbHVtZTogMC44LFxuXHR9KTtcblxuXHRjb25maWcuY3VycmVudE1vdmVtZW50cyA9IGV2ZW50LmRldGFpbC5jb21tYW5kcy5tYXAoKGN1cnJlbnRWYWx1ZSwgaW5kZXgsIGFycmF5KSA9PiB7XG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRpbmRleDogaW5kZXgsXG5cdFx0XHRcdG5hbWU6IGN1cnJlbnRWYWx1ZSxcblx0XHRcdFx0Y29sb3I6IGNvbmZpZy5jb2xvcnMubmV1dHJhbCxcblx0XHRcdH1cblx0fSk7XG5cblx0Ly8gQlBNLCBtaW5JbnRlcnZhbCwgYmVnaW5uaW5nIG9mZnNldFxuXHQvLyBjb25maWcuY3VycmVudEJwbSA9IGV2ZW50LmRldGFpbC5icG07XG5cdGNvbmZpZy5jdXJyZW50QnBtID0gMTI4O1xuXHRjb25maWcuY3VycmVudE1pbkludGVydmFsID0gKGNvbmZpZy5jdXJyZW50QnBtICogMTAwMCkgLyAoNjAgKiAxNik7XG5cdGNvbmZpZy5jdXJyZW50QmVnaW5uaW5nT2Zmc2V0ID0gZXZlbnQuZGV0YWlsLm9mZnNldDtcblxuXHQvLyBUZXN0XG5cdC8vIGFkZE1vdmVtZW50T25DYW52YXMoY29uZmlnLmN1cnJlbnRNb3ZlbWVudHNbMV0pO1xuXHRzdGFydCgpO1xuXG59XG5cbmZ1bmN0aW9uIHN0YXJ0KCkge1xuXHRjb25maWcuY3VycmVudFNjb3JlID0gMDtcblx0Y29uZmlnLmN1cnJlbnRTdGFydERhdGUgPSBEYXRlLm5vdygpO1xuXHRzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG5cdFx0bmV4dEJlYXQodHJ1ZSk7XG5cdH0sIGNvbmZpZy5jdXJyZW50QmVnaW5uaW5nT2Zmc2V0KTtcblx0Y29uZmlnLmN1cnJlbnRBdWRpby5wbGF5KCk7XG59XG5cbmZ1bmN0aW9uIG5leHRCZWF0KGlzRmlyc3QpIHtcblxuXHQvLyBJZiB3ZSdyZSBpbiB0aGUgYmVnaW5uaW5nIG9mIHNvbmdcblx0aWYgKGlzRmlyc3QgPT09IHRydWUpIHtcblx0XHRhZGRNb3ZlbWVudE9uQ2FudmFzKGNvbmZpZy5jdXJyZW50TW92ZW1lbnRzWzBdKTtcblx0XHRhbmltYXRlTW92ZW1lbnQoY29uZmlnLmN1cnJlbnRNb3ZlbWVudHNbMF0pO1xuXHRcdC8vIHNldFRpbWVvdXQobmV4dEJlYXQsIGNvbmZpZy5jdXJyZW50TWluSW50ZXJ2YWwpO1xuXHRcdHJldHVybjtcblx0fVxuXG5cdC8vIEluc2VydCBuZXcgbW92ZW1lbnRcblx0dmFyIGFwcGVhcmluZ01vdmVtZW50SW5kZXggPSBNYXRoLmZsb29yKChEYXRlLm5vdygpIC0gY29uZmlnLmN1cnJlbnRTdGFydERhdGUpIC8gY29uZmlnLmN1cnJlbnRNaW5JbnRlcnZhbCk7XG5cblx0Y29uc29sZS5sb2coYXBwZWFyaW5nTW92ZW1lbnRJbmRleCk7XG5cdFxuXHR2YXIgYXBwZWFyaW5nTW92ZW1lbnQgPSBjb25maWcuY3VycmVudE1vdmVtZW50c1thcHBlYXJpbmdNb3ZlbWVudEluZGV4XTtcblxuXHRhZGRNb3ZlbWVudE9uQ2FudmFzKGFwcGVhcmluZ01vdmVtZW50KTtcblx0YW5pbWF0ZU1vdmVtZW50KGFwcGVhcmluZ01vdmVtZW50KTtcblx0Ly8gc2V0VGltZW91dChuZXh0QmVhdCwgY29uZmlnLmN1cnJlbnRNaW5JbnRlcnZhbCk7XG5cdGNvbnNvbGUubG9nKGFwcGVhcmluZ01vdmVtZW50SW5kZXgpO1xuXG59XG5cblxuXG5cblxuXG5cblxuXG4vLyAqKioqKioqKlxuLy8gKiBJbml0ICpcbi8vICoqKioqKioqXG5cbmNvbmZpZy5jdXJyZW50TW92ZW1lbnRzID0gW107XG5jb25maWcuY3VycmVudFNjb3JlID0gMDtcbmNvbmZpZy5jdXJyZW50U3RhcnREYXRlID0gMDtcblxuLy8gR2V0IGNvbXB1dGVkIHN0eWxlcyBvZiB3aG9sZSBwYWdlIHdyYXBwZXJcbnZhciBjYW52YXNDb21wdXRlZFN0eWxlT2JqID0gZ2V0Q29tcHV0ZWRTdHlsZShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcud3InKVswXSk7XG5cblxuLy8gU2V0IGNhbnZhcyBvcHRpb25zXG5jb25maWcub25lV1BlcmNlbnQgPSBwYXJzZUludChjYW52YXNDb21wdXRlZFN0eWxlT2JqLndpZHRoLnNsaWNlKDAsLTIpKS8xMDA7XG5jb25maWcub25lSFBlcmNlbnQgPSBwYXJzZUludChjYW52YXNDb21wdXRlZFN0eWxlT2JqLmhlaWdodC5zbGljZSgwLC0yKSkvMTAwO1xuXG5jb25maWcuY2Fudk9wdHMgPSB7XG5cdGJnVVJMOiAnLi4vaW1nL2JnLWNyb3dkLTEuanBnJyxcblx0Y29tcHV0ZWRTdHlsZToge1xuXHRcdHdpZHRoOiBjb25maWcub25lV1BlcmNlbnQqMTAwLFxuXHRcdGhlaWdodDogY29uZmlnLm9uZUhQZXJjZW50KjEwMFxuXHR9LFxuXHRtb3ZlbWVudHM6IHtcblx0XHRyYWRpdXM6IGNvbmZpZy5vbmVXUGVyY2VudCAqIGNvbmZpZy5tb3ZlbWVudHMucmFkaXVzUGVyY2VudCxcblx0XHRzdHJva2VXaWR0aDogY29uZmlnLm9uZVdQZXJjZW50ICogY29uZmlnLm1vdmVtZW50cy5zdHJva2VXaWR0aFBlcmNlbnRcblx0fVxufVxuXG5cbi8vIEluaXRpYWxpemUgJ2ZhYnJpYycgY2FudmFzIG9ialxudmFyIGNhbnZhcyA9IG5ldyBmYWJyaWMuU3RhdGljQ2FudmFzKCdnYW1lJywge1xuXHR3aWR0aDogY29uZmlnLmNhbnZPcHRzLmNvbXB1dGVkU3R5bGUud2lkdGgsXG5cdGhlaWdodDogY29uZmlnLmNhbnZPcHRzLmNvbXB1dGVkU3R5bGUuaGVpZ2h0LFxufSk7XG5cbi8vIERyYXcgXCJwZXJmZWN0IHN1Y2Nlc3NcIiBwbGFjZSBzaGFkb3cgY2lyY2xlXG52YXIgc2hhZG93Q2lyY2xlID0gbmV3IGZhYnJpYy5DaXJjbGUoe1xuXHQvLyBmaWxsOiBjb25maWcuY29sb3JzLm5ldXRyYWwsXG5cdGZpbGw6ICdyZ2JhKDIwMCwyMDAsMjAwLDAuMiknLFxuXHRzdHJva2U6ICdyZ2JhKDIwMCwyMDAsMjAwLDEpJyxcblx0c3Ryb2tlV2lkdGg6IGNvbmZpZy5jYW52T3B0cy5tb3ZlbWVudHMuc3Ryb2tlV2lkdGgsXG5cdHJhZGl1czogY29uZmlnLmNhbnZPcHRzLm1vdmVtZW50cy5yYWRpdXMsXG5cdHRvcDogTWF0aC5yb3VuZChjb25maWcub25lSFBlcmNlbnQqNDUpLFxuXHRsZWZ0OiBjb25maWcub25lV1BlcmNlbnQgKiAyMFxufSlcbmNhbnZhcy5hZGQoc2hhZG93Q2lyY2xlKTtcblxuLy8gU2V0IGhhbmRsZXIgZm9yIGdhbWUgc2V0dXAgZXZlbnRcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2FnU2V0dXBFdmVudCcsIG9uQWdTZXR1cEV2ZW50KTtcblxuLy8gU2hvdyBjdXJyZW50IGdhbWUgY29kZVxudmFyIGNvZGVDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29kZS1jb250YWluZXInKTtcbmNvZGVDb250YWluZXIuaW5uZXJIVE1MID0gY29kZTtcblxuXG4vLyAqKioqKioqKipcbi8vICogQXVkaW8gKlxuLy8gKioqKioqKioqXG5cbi8vIEFkZCBtdXRlZCBzdGF0ZSBzYXZpbmcgZmVhdHVyZSB0byBIb3dsIChhdWRpbyBsaWIpXG5Ib3dsLnByb3RvdHlwZS5tdXRlZCA9IGZhbHNlO1xuSG93bC5tdXRlZCA9IGZhbHNlO1xuXG4vLyBHZXQgdm9sdW1lIGJ1dHRvbiBlbGVtZW50XG52YXIgdm9sdW1lQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnZvbHVtZS1idG4nKVswXTtcbi8vIGFuZCBzZXQgb25DbGljayBldmVudCBoYW5kbGVyXG52b2x1bWVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvblZvbHVtZUJ0bkNsaWNrKTtcblxuLy8gR2V0IHZvbHVtZSBsZXZlbCBzbGlkZXJcbnZhciB2b2x1bWVTbGlkZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudm9sdW1lLWlucHV0JylbMF07XG4vLyBhbmQgc2V0IG9uSW5wdXQgZXZlbnQgaGFuZGxlclxudm9sdW1lU2xpZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25Wb2x1bWVTbGlkZXJJbnB1dClcblxuXG4vLyBDaGFuZ2UgY2FudmFzIGJhY2tncm91bmQgc2l6ZSBvbiB3aW5kb3cgcmVzaXplXG53aW5kb3cub25yZXNpemUgPSBmdW5jdGlvbigpe1xuXHRyZWZyZXNoQ29tcHV0ZWRTaXplcyhjYW52YXNDb21wdXRlZFN0eWxlT2JqKTtcblx0Y2FudmFzLnJlbmRlckFsbC5iaW5kKGNhbnZhcyk7XG59XG5cblxuXG5cblxuXG5cblxuXG4vLyBURVNUXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNsb3NlUG9wdXApO1xuXG59KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
